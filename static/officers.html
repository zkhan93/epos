<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <title>Officers</title>
  </head>
  <body>
    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>

    <!-- Vue.js 3 -->

    <script src="https://cdn.jsdelivr.net/npm/axios@0.26.1/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.31/dist/vue.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/lodash/4.13.1/lodash.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.2/moment.min.js"></script>
    <div id="app" class="container">
      <h2 class="mt-3">Kaimur Officers</h2>
      <div class="mb-2">
        <select class="form-select" v-model="selected_type">
          <option value="all">All</option>
          <option v-bind:value="type" v-for="type in types" :key="type"
            >{{type}}</option
          >
        </select>
      </div>
      <div v-if="loading">
        Loading...
      </div>
      <div class="list-group" v-if="filtered_officers.length">
        <div
          class="list-group-item"
          v-for="officer in filtered_officers"
          :key="officer.id"
        >
          <template v-for="head in headers" :key="officer.id + head.id">
            <span>{{head.name}}: <b>{{officer[head.name]}}</b></span
            ><br />
          </template>
        </div>
      </div>
    </div>
    <script>
      // POST here http://epos.bihar.gov.in/FPS_Trans_Details.jsp
      // with
      // dist_code=233 fps_id=123300100909 month=3 year=2022

      Vue.createApp({
        data() {
          return {
            selected_type: "all",
            officers: [],
            headers: [
              { id: "name", name: "Name" },
              { id: "designation", name: "Designation" },
              { id: "type", name: "Type" },
              { id: "mobile_number", name: "Mobile No" },
              { id: "address", name: "Address" },
              { id: "email_address", name: "Email" },
              { id: "landline_number", name: "Landline No" },
              { id: "fax_number", name: "Fax No" },
            ],
            loading: false,
          };
        },
        computed: {
          types() {
            var type_set = new Set();
            this.officers.forEach((officer) => {
              type_set.add(officer.Type);
            });
            return Array.from(type_set);
          },
          filtered_officers() {
            if (this.selected_type === "all") return this.officers;
            return this.officers.filter(
              (officer) => officer.Type === this.selected_type
            );
          },
        },
        created() {
          this.fetch_officers();
        },
        methods: {
          fetch_officers() {
            this.loading = true;
            axios
              .get("/get-kaimur-officers")
              .then((res) => {
                this.loading = false;
                this.officers = res.data;
              })
              .catch(() => {
                this.loading = false;
              });
          },
        },
      }).mount("#app");
    </script>
  </body>
</html>
